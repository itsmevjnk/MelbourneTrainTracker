<!DOCTYPE html>

<html>
    <head>
        <title>Melbourne Train Tracker | Board View</title>
        <style>
            body { margin:0; }
            #board { background-image:url('board.jpg');background-size:contain;background-repeat:no-repeat;width:100%;height:0;padding-top:92.6644%; }
            #board .led { background-color:#000;width:calc(2/423.5*100cqw);height:calc(2/423.5*100cqw);position:absolute;border:1px solid white; }
        </style>
    </head>

    <body>
        <div id="board">
        </div>
        <script>
            // add LEDs
            const components={"D1":[113.9,25.95],"D10":[113.9,61.95],"D100":[48.9,183.95],"D101":[52.4,187.45],"D102":[56.4,187.45],"D103":[60.4,187.45],"D104":[64.4,187.45],"D105":[68.4,187.45],"D106":[71.9,183.95],"D107":[55.23,179.95],"D108":[65.57,179.95],"D109":[75.9,203.95],"D11":[113.9,65.95],"D110":[75.9,199.95],"D111":[75.9,195.95],"D112":[75.9,191.95],"D113":[75.9,187.95],"D114":[75.9,183.95],"D115":[75.9,179.95],"D116":[79.4,176.45],"D117":[82.9,172.95],"D118":[86.4,169.45],"D119":[89.9,165.95],"D12":[113.9,69.95],"D120":[93.4,162.45],"D121":[96.9,158.95],"D122":[100.4,155.45],"D123":[103.9,151.95],"D124":[107.9,151.95],"D125":[111.9,151.95],"D126":[115.9,151.95],"D127":[54.15,138.7],"D128":[75.9,147.95],"D129":[103.9,147.95],"D13":[113.9,73.95],"D130":[117.7,147.95],"D131":[119.9,151.95],"D132":[123.4,155.45],"D133":[20.15,108.7],"D134":[20.15,112.7],"D135":[20.15,116.7],"D136":[20.15,120.7],"D137":[23.65,124.2],"D138":[27.15,127.7],"D139":[30.65,131.2],"D14":[113.9,77.95],"D140":[34.15,134.7],"D141":[38.15,138.7],"D142":[42.15,138.7],"D143":[46.15,138.7],"D144":[50.15,138.7],"D145":[14.15,138.7],"D146":[18.15,138.7],"D147":[22.15,138.7],"D148":[26.15,138.7],"D149":[30.15,138.7],"D15":[113.9,81.95],"D150":[34.15,138.7],"D151":[126.9,177.45],"D152":[126.9,183.45],"D153":[130.9,177.45],"D154":[130.9,183.45],"D155":[134.9,177.45],"D156":[134.9,183.45],"D157":[138.9,177.45],"D158":[138.9,183.45],"D159":[142.9,177.45],"D16":[113.9,85.95],"D160":[142.9,183.45],"D161":[146.9,177.45],"D162":[146.9,183.45],"D163":[156,151],"D164":[151.1,151],"D165":[156,155],"D166":[151.1,155],"D167":[156,159],"D168":[151.1,159],"D169":[180,151],"D17":[113.9,89.95],"D170":[174.9,151],"D171":[180,155],"D172":[174.9,155],"D173":[180,159],"D174":[174.9,159],"D175":[204.9,174.45],"D176":[204.9,168.55],"D177":[200.9,174.45],"D178":[200.9,168.55],"D179":[196.9,174.45],"D18":[113.9,93.95],"D180":[196.9,168.55],"D181":[156,163],"D182":[151.1,163],"D183":[180,163],"D184":[174.9,163],"D185":[192.9,174.45],"D186":[192.9,168.55],"D187":[185,148.5],"D188":[185,165.5],"D189":[185,193.5],"D19":[113.9,97.95],"D190":[185,222.5],"D191":[188.6,237.55],"D192":[208.6,240.95],"D193":[180,220],"D194":[180,216],"D195":[180,212],"D196":[180,208],"D197":[180,204],"D198":[180,200],"D199":[180,196],"D2":[113.9,29.95],"D20":[113.9,101.95],"D200":[195.6,198.55],"D201":[215.9,236.95],"D202":[212.4,233.45],"D203":[205.4,226.45],"D204":[201.9,222.95],"D205":[226.4,226.45],"D206":[222.9,222.95],"D207":[219.4,233.45],"D208":[215.9,229.95],"D209":[208.9,222.95],"D21":[113.9,105.95],"D210":[205.4,219.45],"D211":[212.4,219.45],"D212":[208.9,215.95],"D213":[215.9,215.95],"D214":[212.4,212.45],"D215":[219.4,212.45],"D216":[215.9,208.95],"D217":[341.9,69.55],"D218":[337.9,69.55],"D219":[333.9,69.55],"D22":[113.9,109.95],"D220":[329.9,69.55],"D221":[325.9,69.55],"D222":[321.9,69.55],"D223":[317.9,69.55],"D224":[313.9,69.55],"D225":[309.9,69.55],"D226":[305.9,69.55],"D227":[301.9,69.55],"D228":[297.9,69.55],"D229":[293.9,69.55],"D23":[113.9,113.95],"D230":[289.9,69.55],"D231":[283.9,73.05],"D232":[280.4,76.55],"D233":[276.9,80.05],"D234":[273.4,83.55],"D235":[269.9,87.05],"D236":[266.4,90.55],"D237":[262.9,94.05],"D238":[259.4,97.55],"D239":[255.9,101.05],"D24":[113.9,117.95],"D240":[255.9,105.05],"D241":[255.9,109.05],"D242":[255.9,113.05],"D243":[255.9,117.05],"D244":[255.9,121.05],"D245":[255.9,125.05],"D246":[255.9,129.05],"D247":[255.9,133.05],"D248":[255.9,137.05],"D249":[255.9,141.05],"D25":[113.9,121.95],"D250":[255.9,145.05],"D251":[255.9,149.05],"D252":[255.9,153.05],"D253":[386.4,97.05],"D254":[382.4,97.05],"D255":[378.4,97.05],"D256":[374.4,97.05],"D257":[370.4,97.05],"D258":[366.4,97.05],"D259":[362.4,97.05],"D26":[113.9,125.95],"D260":[358.4,97.05],"D261":[354.4,97.05],"D262":[350.4,97.05],"D263":[346.4,97.05],"D264":[342.4,97.05],"D265":[338.4,97.05],"D266":[334.4,97.05],"D267":[330.4,97.05],"D268":[326.4,97.05],"D269":[322.4,97.05],"D27":[101.9,117.95],"D270":[318.4,97.05],"D271":[312.4,100.55],"D272":[308.9,104.05],"D273":[305.4,107.55],"D274":[301.9,111.05],"D275":[298.4,114.55],"D276":[294.9,118.05],"D277":[291.4,121.55],"D278":[287.9,125.05],"D279":[284.4,128.55],"D28":[98.4,114.45],"D280":[280.9,132.05],"D281":[277.4,135.55],"D282":[273.9,139.05],"D283":[270.4,142.55],"D284":[266.9,146.05],"D285":[263.4,149.55],"D286":[259.9,153.05],"D287":[255.9,157.05],"D288":[252.4,160.55],"D289":[248.9,164.05],"D29":[105.4,121.45],"D290":[245.4,167.55],"D291":[241.9,171.05],"D292":[238.4,174.55],"D293":[234.9,178.05],"D294":[231.4,181.55],"D295":[227.9,185.05],"D296":[224.4,188.55],"D297":[220.9,192.05],"D298":[217.4,195.55],"D299":[233.4,216.05],"D3":[113.9,33.95],"D30":[108.9,124.95],"D300":[227.4,216.05],"D301":[420.4,195.05],"D302":[416.9,191.55],"D303":[413.4,188.05],"D304":[409.9,184.55],"D305":[406.4,181.05],"D306":[402.9,177.55],"D307":[399.4,174.05],"D308":[395.9,170.55],"D309":[392.4,167.05],"D31":[113.9,129.95],"D310":[388.9,163.55],"D311":[385.4,160.05],"D312":[381.9,156.55],"D313":[378.4,153.05],"D314":[374.9,149.55],"D315":[371.4,146.05],"D316":[367.15,141.8],"D317":[362.9,137.55],"D318":[358.9,137.55],"D319":[354.9,137.55],"D32":[117.4,133.45],"D320":[350.9,137.55],"D321":[346.9,137.55],"D322":[342.9,137.55],"D323":[338.9,137.55],"D324":[334.9,137.55],"D325":[330.9,137.55],"D326":[326.9,137.55],"D327":[321.9,142.55],"D328":[318.4,146.05],"D329":[314.9,149.55],"D33":[120.9,136.95],"D330":[311.4,153.05],"D331":[307.9,156.55],"D332":[304.4,160.05],"D333":[300.9,163.55],"D334":[297.4,167.05],"D335":[293.9,170.55],"D336":[290.4,174.05],"D337":[286.9,177.55],"D338":[283.4,181.05],"D339":[276.4,188.05],"D34":[124.4,140.45],"D340":[272.9,191.55],"D341":[269.4,195.05],"D342":[265.9,198.55],"D343":[262.4,202.05],"D344":[258.9,205.55],"D345":[255.4,209.05],"D346":[251.9,212.55],"D347":[245.4,216.05],"D348":[239.4,216.05],"D349":[412.9,137.55],"D35":[127.9,143.95],"D350":[406.9,137.55],"D351":[400.9,137.55],"D352":[394.9,137.55],"D353":[388.9,137.55],"D354":[382.9,137.55],"D355":[376.9,137.55],"D356":[370.9,137.55],"D357":[331.9,224.8],"D358":[328.4,221.3],"D359":[324.9,217.8],"D36":[147,167.55],"D360":[321.4,214.3],"D361":[317.9,210.8],"D362":[314.4,207.3],"D363":[310.9,203.8],"D364":[307.4,200.3],"D365":[303.9,196.8],"D366":[300.4,193.3],"D367":[296.9,189.8],"D368":[289.1,185.05],"D369":[339,254.55],"D37":[57.65,79.2],"D370":[335,254.55],"D371":[331,254.55],"D372":[327,254.55],"D373":[323,254.55],"D374":[319,254.55],"D375":[315,254.55],"D376":[311,254.55],"D377":[307,254.55],"D378":[303,254.55],"D379":[299,254.55],"D38":[57.65,83.2],"D380":[295,254.55],"D381":[291,254.55],"D382":[287,254.55],"D383":[283.5,251.05],"D384":[280,247.55],"D385":[276.5,244.05],"D386":[273,240.55],"D387":[269.5,237.05],"D388":[266,233.55],"D389":[262.5,230.05],"D39":[57.65,87.2],"D390":[259,226.55],"D391":[255.5,223.05],"D392":[252,219.55],"D393":[421,361],"D394":[417,361],"D395":[413,361],"D396":[409,361],"D397":[413,365],"D398":[399,365],"D399":[405,361],"D4":[113.9,37.95],"D40":[57.65,91.2],"D400":[401,361],"D401":[397,361],"D402":[393,361],"D403":[389,361],"D404":[385,361],"D405":[381,361],"D406":[377,361],"D407":[381,365],"D408":[363.5,365],"D409":[373,361],"D41":[57.65,95.2],"D410":[369,361],"D411":[357.5,388.05],"D412":[357.5,384.05],"D413":[357.5,380.05],"D414":[357.5,376.05],"D415":[357.5,372.05],"D416":[357.5,368.05],"D417":[365,361],"D418":[361,361],"D419":[354,354],"D42":[57.65,99.2],"D420":[350.5,350.5],"D421":[347,347],"D422":[343.5,343.5],"D423":[340,340],"D424":[336.5,336.5],"D425":[333,333],"D426":[329.5,329.5],"D427":[350.75,357.25],"D428":[328.4,335.05],"D429":[268.9,269.05],"D43":[57.65,103.2],"D430":[234.9,235.05],"D431":[265.6,272.05],"D432":[242.4,249.05],"D433":[326,326],"D434":[322.5,322.5],"D435":[319,319],"D436":[315.5,315.5],"D437":[312,312],"D438":[308.1,308.05],"D439":[308.6,315.05],"D44":[57.65,107.2],"D440":[286.1,292.55],"D441":[304.6,304.55],"D442":[301.1,301.05],"D443":[297.6,297.55],"D444":[294.1,294.05],"D445":[290.6,290.55],"D446":[287.1,287.05],"D447":[283.6,283.55],"D448":[280.1,280.05],"D449":[276.6,276.55],"D45":[57.65,111.2],"D450":[273.1,273.05],"D451":[390.4,407.95],"D452":[386.4,407.95],"D453":[382.4,407.95],"D454":[378.4,407.95],"D455":[374.4,407.95],"D456":[370.4,407.95],"D457":[366.4,407.95],"D458":[362.4,407.95],"D459":[358.4,407.95],"D46":[57.65,115.2],"D460":[354.4,407.95],"D461":[350.4,407.95],"D462":[346.4,407.95],"D463":[342.4,407.95],"D464":[338.4,407.95],"D465":[334.4,407.95],"D466":[330.4,407.95],"D467":[326.4,407.95],"D468":[322.4,407.95],"D469":[318.4,407.95],"D47":[57.65,119.2],"D471":[318.4,403.95],"D472":[314.4,403.95],"D473":[310.4,403.95],"D474":[306.4,403.95],"D475":[302.4,403.95],"D476":[298.4,403.95],"D477":[294.4,403.95],"D478":[290.4,403.95],"D479":[286.9,400.45],"D48":[57.65,123.2],"D480":[283.4,396.95],"D481":[279.9,393.45],"D482":[276.4,389.95],"D483":[272.9,386.45],"D484":[269.4,382.95],"D485":[265.9,379.45],"D486":[265.9,375.45],"D487":[265.9,371.45],"D488":[265.9,367.45],"D489":[265.9,363.45],"D49":[57.65,127.2],"D490":[265.9,359.45],"D491":[265.9,355.45],"D492":[265.9,351.45],"D493":[265.9,347.45],"D494":[265.9,343.45],"D495":[265.9,339.45],"D496":[265.9,335.45],"D497":[265.9,331.45],"D498":[265.9,327.45],"D499":[265.9,323.45],"D5":[113.9,41.95],"D50":[57.65,131.2],"D500":[265.9,319.45],"D501":[265.9,315.45],"D502":[265.9,311.45],"D503":[265.9,307.45],"D504":[265.9,303.45],"D505":[265.9,299.45],"D506":[265.9,295.45],"D507":[265.9,291.45],"D51":[57.65,135.2],"D511":[265.9,287.45],"D512":[265.9,283.45],"D513":[265.4,278.95],"D514":[215,247.5],"D515":[210.5,273],"D517":[261.9,275.45],"D518":[258.4,271.95],"D519":[254.9,268.45],"D52":[61.15,138.7],"D523":[251.4,264.95],"D524":[247.9,261.45],"D525":[244.4,257.95],"D529":[240.9,254.45],"D53":[66.4,143.95],"D530":[237.4,250.95],"D531":[233.9,247.45],"D535":[230.4,243.95],"D536":[210.5,322],"D537":[210.5,318.5],"D54":[72.65,143.95],"D541":[210.5,315],"D542":[210.5,311.5],"D543":[210.5,308],"D547":[210.5,304.5],"D548":[210.5,301],"D549":[210.5,297.5],"D55":[78.9,143.95],"D553":[210.5,294],"D554":[210.5,290.5],"D555":[210.5,287],"D559":[210.5,283.5],"D56":[85.15,143.95],"D560":[210.5,280],"D561":[210.5,276.5],"D565":[210.5,269.5],"D566":[210.5,266],"D567":[210.5,262.5],"D57":[91.4,143.95],"D571":[210.5,259],"D572":[210.5,255.5],"D573":[210.5,252],"D58":[97.65,143.95],"D59":[103.9,143.95],"D6":[113.9,45.95],"D60":[115.9,143.95],"D61":[172.4,43.45],"D62":[172.4,47.45],"D63":[172.4,51.45],"D64":[172.4,55.45],"D65":[172.4,59.45],"D66":[172.4,63.45],"D67":[172.4,67.45],"D68":[172.4,71.45],"D69":[172.4,75.45],"D7":[113.9,49.95],"D70":[172.4,79.45],"D71":[172.4,83.45],"D72":[172.4,87.45],"D73":[172.4,91.45],"D74":[172.4,95.45],"D75":[172.4,99.45],"D76":[168.9,102.95],"D77":[165.4,106.45],"D78":[161.9,109.95],"D79":[158.4,113.45],"D8":[113.9,53.95],"D80":[154.9,116.95],"D81":[151.4,120.45],"D82":[147.9,123.95],"D83":[144.4,127.45],"D84":[140.9,130.95],"D85":[137.4,134.45],"D86":[132.65,139.2],"D87":[145.5,141.5],"D88":[155.5,141.5],"D89":[165.5,141.5],"D9":[113.9,57.95],"D90":[175.5,141.5],"D91":[16.9,151.95],"D92":[20.4,155.45],"D93":[23.9,158.95],"D94":[27.4,162.45],"D95":[30.9,165.95],"D96":[34.4,169.45],"D97":[37.9,172.95],"D98":[41.4,176.45],"D99":[44.9,179.95]};
            const board = document.getElementById('board');
            for (const [name, pos] of Object.entries(components)) {
                board.innerHTML += `<div class="led" id="${name}" style="left:${pos[0]/423.5*100-2.3}cqw;top:${pos[1]/423.5*100-5.75}cqw;"></div>`;
            }
            const rows = [3 * 6, 3 * 6, 3 * 6, 3 * 6, 3 * 6, 3 * 6, 3 * 6, 3 * 4];
            const chipOffsets = [0]; for (let i = 1; i < 8; i++) chipOffsets.push(chipOffsets[chipOffsets.length - 1] + 12 * rows[i - 1]);
            const offset = (chip, col, row) => chipOffsets[chip] + rows[chip] * col + row * 3;
            const ledOffsets = {"D514":offset(7,11,3),"D515":offset(7,9,3)};
            for (const [col, led] of Object.entries([505, 511, 517, 523, 529, 535, 541, 547, 553, 559, 565, 571])) {
                for (let i = 0; i < 3; i++) ledOffsets[`D${led+i}`] = offset(7,col*1,i);
            }
            for (let chip = 0; chip < 7; chip++) {
                for (let col = 0; col < 12; col++) {
                    for (let row = 0; row < 6; row++) ledOffsets[`D${chip*72+col*6+row+1}`] = offset(chip, col, row);
                }
            }
            delete ledOffsets['D470'];
            const socket = new WebSocket(`ws://${window.location.hostname}/ws/buffer`);
            const colours = {
                "160,5,10": "#f178af",
                "0,128,0": "#028430",
                "24,24,128": "#279fd5",
                "0,0,128": "#152c6b",
                "128,64,0": "#ffbe00",
                "128,0,0": "#be1014",
                "96,96,96": "#95979a",
                "64,0,128": "#7f0d82",
                "0,0,0": "black"
            }; // colour map
            socket.onmessage = async (event) => {
                const buf = new Uint8Array(await event.data.arrayBuffer());
                for (const [led, offset] of Object.entries(ledOffsets)) {
                    const rgb = `${buf[offset]},${buf[offset+1]},${buf[offset+2]}`;
                    document.getElementById(led).style.backgroundColor = colours[rgb] || `rgb(${rgb})`;
                }
            };
        </script>
    </body>
</html>